/*
--Department Hours by Job Code
SELECT * 
FROM VW_RPT_GP_DEPT_HOURS_BY_JOBCODE (NOLOCK) 
WHERE 1 = 1 
AND (	NULLRECORD = 'Y' OR
		CHECKDATE BETWEEN '09/01/2023' AND '09/01/2024'
	)
ORDER BY JOBCODE, WAREHOUSE, DEPARTMENT, CHECKDATE

*/
CREATE OR ALTER VIEW [DBO].[VW_RPT_GP_DEPT_HOURS_BY_JOBCODE] 
AS 
SELECT 'SB' AS COMPANYID, NULLRECORD, 
	WAREHOUSE, DEPARTMENT, DEPTDESC, JOBCODE, JOBDESC, 
	CAST (CHECKDATE AS DATE) AS CHECKDATE, PAYROLCD, 
	SUM(HOURS) AS HOURS, 
	IIF(DEPARTMENT=100, SUM(HOURS), 0) AS '100', 
	IIF(DEPARTMENT=103, SUM(HOURS), 0) AS '103', 
	IIF(DEPARTMENT=110, SUM(HOURS), 0) AS '110', 
	IIF(DEPARTMENT=112, SUM(HOURS), 0) AS '112', 
	IIF(DEPARTMENT=113, SUM(HOURS), 0) AS '113', 
	IIF(DEPARTMENT=114, SUM(HOURS), 0) AS '114', 
	IIF(DEPARTMENT=115, SUM(HOURS), 0) AS '115', 
	IIF(DEPARTMENT=116, SUM(HOURS), 0) AS '116', 
	IIF(DEPARTMENT=117, SUM(HOURS), 0) AS '117', 
	IIF(DEPARTMENT=118, SUM(HOURS), 0) AS '118', 
	IIF(DEPARTMENT=119, SUM(HOURS), 0) AS '119', 
	IIF(DEPARTMENT=120, SUM(HOURS), 0) AS '120', 
	IIF(DEPARTMENT=121, SUM(HOURS), 0) AS '121', 
	IIF(DEPARTMENT=122, SUM(HOURS), 0) AS '122', 
	IIF(DEPARTMENT=123, SUM(HOURS), 0) AS '123', 
	IIF(DEPARTMENT=124, SUM(HOURS), 0) AS '124', 
	IIF(DEPARTMENT=126, SUM(HOURS), 0) AS '126', 
	IIF(DEPARTMENT=127, SUM(HOURS), 0) AS '127', 
	IIF(DEPARTMENT=128, SUM(HOURS), 0) AS '128', 
	IIF(DEPARTMENT=129, SUM(HOURS), 0) AS '129', 
	IIF(DEPARTMENT=131, SUM(HOURS), 0) AS '131', 
	IIF(DEPARTMENT=140, SUM(HOURS), 0) AS '140', 
	IIF(DEPARTMENT=141, SUM(HOURS), 0) AS '141', 
	IIF(DEPARTMENT=142, SUM(HOURS), 0) AS '142', 
	IIF(DEPARTMENT=143, SUM(HOURS), 0) AS '143', 
	IIF(DEPARTMENT=151, SUM(HOURS), 0) AS '151', 
	IIF(DEPARTMENT=152, SUM(HOURS), 0) AS '152', 
	IIF(DEPARTMENT=153, SUM(HOURS), 0) AS '153', 
	IIF(DEPARTMENT=154, SUM(HOURS), 0) AS '154', 
	IIF(DEPARTMENT=155, SUM(HOURS), 0) AS '155', 
	IIF(DEPARTMENT=156, SUM(HOURS), 0) AS '156', 
	IIF(DEPARTMENT=157, SUM(HOURS), 0) AS '157', 
	IIF(DEPARTMENT=158, SUM(HOURS), 0) AS '158', 
	IIF(DEPARTMENT=159, SUM(HOURS), 0) AS '159', 
	IIF(DEPARTMENT=160, SUM(HOURS), 0) AS '160', 
	IIF(DEPARTMENT=161, SUM(HOURS), 0) AS '161', 
	IIF(DEPARTMENT=162, SUM(HOURS), 0) AS '162', 
	IIF(DEPARTMENT=163, SUM(HOURS), 0) AS '163', 
	IIF(DEPARTMENT=190, SUM(HOURS), 0) AS '190', 
	IIF(DEPARTMENT=191, SUM(HOURS), 0) AS '191', 
	IIF(DEPARTMENT=200, SUM(HOURS), 0) AS '200', 
	IIF(DEPARTMENT=210, SUM(HOURS), 0) AS '210', 
	IIF(DEPARTMENT=221, SUM(HOURS), 0) AS '221', 
	IIF(DEPARTMENT=222, SUM(HOURS), 0) AS '222', 
	IIF(DEPARTMENT=223, SUM(HOURS), 0) AS '223', 
	IIF(DEPARTMENT=224, SUM(HOURS), 0) AS '224', 
	IIF(DEPARTMENT=225, SUM(HOURS), 0) AS '225', 
	IIF(DEPARTMENT=226, SUM(HOURS), 0) AS '226', 
	IIF(DEPARTMENT=227, SUM(HOURS), 0) AS '227', 
	IIF(DEPARTMENT=231, SUM(HOURS), 0) AS '231', 
	IIF(DEPARTMENT=232, SUM(HOURS), 0) AS '232', 
	IIF(DEPARTMENT=233, SUM(HOURS), 0) AS '233', 
	IIF(DEPARTMENT=234, SUM(HOURS), 0) AS '234', 
	IIF(DEPARTMENT=235, SUM(HOURS), 0) AS '235', 
	IIF(DEPARTMENT=236, SUM(HOURS), 0) AS '236', 
	IIF(DEPARTMENT=237, SUM(HOURS), 0) AS '237', 
	IIF(DEPARTMENT=238, SUM(HOURS), 0) AS '238', 
	IIF(DEPARTMENT=239, SUM(HOURS), 0) AS '239', 
	IIF(DEPARTMENT=240, SUM(HOURS), 0) AS '240', 
	IIF(DEPARTMENT=241, SUM(HOURS), 0) AS '241', 
	IIF(DEPARTMENT=251, SUM(HOURS), 0) AS '251', 
	IIF(DEPARTMENT=252, SUM(HOURS), 0) AS '252', 
	IIF(DEPARTMENT=253, SUM(HOURS), 0) AS '253', 
	IIF(DEPARTMENT=254, SUM(HOURS), 0) AS '254', 
	IIF(DEPARTMENT=255, SUM(HOURS), 0) AS '255', 
	IIF(DEPARTMENT=256, SUM(HOURS), 0) AS '256', 
	IIF(DEPARTMENT=257, SUM(HOURS), 0) AS '257', 
	IIF(DEPARTMENT=258, SUM(HOURS), 0) AS '258', 
	IIF(DEPARTMENT=259, SUM(HOURS), 0) AS '259', 
	IIF(DEPARTMENT=280, SUM(HOURS), 0) AS '280', 
	IIF(DEPARTMENT=290, SUM(HOURS), 0) AS '290', 
	IIF(DEPARTMENT=303, SUM(HOURS), 0) AS '303', 
	IIF(DEPARTMENT=304, SUM(HOURS), 0) AS '304', 
	IIF(DEPARTMENT=310, SUM(HOURS), 0) AS '310', 
	IIF(DEPARTMENT=311, SUM(HOURS), 0) AS '311', 
	IIF(DEPARTMENT=312, SUM(HOURS), 0) AS '312', 
	IIF(DEPARTMENT=313, SUM(HOURS), 0) AS '313', 
	IIF(DEPARTMENT=325, SUM(HOURS), 0) AS '325', 
	IIF(DEPARTMENT=400, SUM(HOURS), 0) AS '400', 
	IIF(DEPARTMENT=404, SUM(HOURS), 0) AS '404', 
	IIF(DEPARTMENT=408, SUM(HOURS), 0) AS '408', 
	IIF(DEPARTMENT=410, SUM(HOURS), 0) AS '410', 
	IIF(DEPARTMENT=411, SUM(HOURS), 0) AS '411', 
	IIF(DEPARTMENT=412, SUM(HOURS), 0) AS '412', 
	IIF(DEPARTMENT=413, SUM(HOURS), 0) AS '413', 
	IIF(DEPARTMENT=414, SUM(HOURS), 0) AS '414', 
	IIF(DEPARTMENT=415, SUM(HOURS), 0) AS '415', 
	IIF(DEPARTMENT=416, SUM(HOURS), 0) AS '416', 
	IIF(DEPARTMENT=417, SUM(HOURS), 0) AS '417', 
	IIF(DEPARTMENT=451, SUM(HOURS), 0) AS '451', 
	IIF(DEPARTMENT=453, SUM(HOURS), 0) AS '453', 
	IIF(DEPARTMENT=454, SUM(HOURS), 0) AS '454', 
	IIF(DEPARTMENT=456, SUM(HOURS), 0) AS '456', 
	IIF(DEPARTMENT=457, SUM(HOURS), 0) AS '457', 
	IIF(DEPARTMENT=490, SUM(HOURS), 0) AS '490', 
	IIF(DEPARTMENT=810, SUM(HOURS), 0) AS '810', 
	IIF(DEPARTMENT=890, SUM(HOURS), 0) AS '890', 
	IIF(DEPARTMENT=903, SUM(HOURS), 0) AS '903', 
	IIF(DEPARTMENT=905, SUM(HOURS), 0) AS '905', 
	IIF(DEPARTMENT=963, SUM(HOURS), 0) AS '963', 
	IIF(DEPARTMENT=964, SUM(HOURS), 0) AS '964' 
/*
distinct departments:
100    103    110    112    113    114    115    116    117    118    119    120    
121    122    123    124    126    127    128    129    131    140    141    142    143    
151    152    153    154    155    156    157    158    159    160    161    162    163    
190    191    
200    210    221    222    223    224    225    226    227    
231    232    233    234    235    236    237    238    239    240    241    
251    252    253    254    255    256    257    258    259    280    290    
303    304    310    311    312    313    325    
400    404    408    410    411    412    413    414    415    416    417    
451    453    454    456    457    490    
810    890    903    905    963    964 

These additional Departments don't show but weren't needing to be added manually per Radean
101	102	111	125	144	146	147	150	199	
203	220	230	250	260	270	291	
320	330	390	
403	409	452	455	491	
67	
820	830	840	
901	902	904	990	
*/
FROM (
	SELECT 'N' AS NULLRECORD, 
	IIF(LEFT(GP.DEPRTMNT,1)='3', '60', LEFT(GP.DEPRTMNT,1)+'0') WAREHOUSE, 
	GP.DEPRTMNT AS DEPARTMENT, GP.DEPTDESC, 
	GP.JOBTITLE AS JOBCODE, GP.JOBDESC, 
	GP.UNTSTOPY AS HOURS, 
	GP.UPRTRXAM AS DOLLARS, 
	GP.CHEKDATE AS CHECKDATE, 
	GP.PAYROLCD 
	FROM [GNCGPDB\GP2018].PROD.DBO.v_GNC_ProjectReportByDeptWithContractLabor GP (NOLOCK) 
/* DOES THE SAME BELOW AS ABOVE:
	SELECT 'N' AS NULLRECORD, 
	IIF(LEFT(GLF.DEPRTMNT,1)='3', '60', LEFT(GLF.DEPRTMNT,1)+'0') WAREHOUSE, 
	GLF.DEPRTMNT AS DEPARTMENT, UPR40300.DSCRIPTN DEPTDESC, 
	GLF.JOBTITLE AS JOBCODE, UPR40301.DSCRIPTN JOBDESC, 
	GLF.UNTSTOPY AS HOURS, 
	GLF.UPRTRXAM AS DOLLARS, 
	GLF.CHEKDATE AS CHECKDATE, 
	GLF.PAYROLCD 
	FROM [GNCGPDB\GP2018].PROD.DBO.UPR30300 GLF (NOLOCK) 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40301 UPR40301 (NOLOCK) ON GLF.JOBTITLE=UPR40301.JOBTITLE 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40300 UPR40300 (NOLOCK) ON GLF.DEPRTMNT=UPR40300.DEPRTMNT
	WHERE  GLF.PYRLRTYP=1 
	AND GLF.JOBTITLE NOT IN 
			(
				'12702', '12703', 
				'60201', '60201C', '60202', '60300', '60300F', 
				'80100', '80500', '81000', '83001', '83002', '83500', 
				'90101', '90101P', '90101T', '90102', '90203', '90203F', '90203P'
			) 
	AND GLF.PAYROLCD NOT IN ('LIFE','VEHICL')
	AND GLF.CHEKDATE > CAST ('09/01/2019' AS DATETIME) - 52*7 

UNION ALL

	SELECT 'N' AS NULLRECORD, 
	IIF(LEFT(CON.DPRTMNT,1)='3', '60', LEFT(CON.DPRTMNT,1)+'0') WAREHOUSE, 
	CON.DPRTMNT AS DEPARTMENT, UPR40300.DSCRIPTN DEPTDESC, 
	CON.JOBTITLE AS JOBCODE, UPR40301.DSCRIPTN JOBDESC, 
	CON.UNTSTOPY AS HOURS, 
	CON.UPRTRXAM AS DOLLARS, 
	CON.CHEKDATE AS CHECKDATE, 
	CON.PAYROLCD 
	FROM [GNCGPDB\GP2018].PROD.DBO.ContractLaborPay CON (NOLOCK) 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40301 UPR40301 (NOLOCK) ON CON.JOBTITLE=UPR40301.JOBTITLE 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40300 UPR40300 (NOLOCK) ON CON.DPRTMNT=UPR40300.DEPRTMNT
	WHERE  CON.PYRLRTYP=1 
	AND CON.JOBTITLE NOT IN 
			(
				'12702', '12703', 
				'60201', '60201C', '60202', '60300', '60300F', 
				'80100', '80500', '81000', '83001', '83002', '83500', 
				'90101', '90101P', '90101T', '90102', '90203', '90203F', '90203P'
			) 
	AND CON.PAYROLCD NOT IN ('LIFE','VEHICL')
	AND CON.CHEKDATE > CAST ('09/01/2019' AS DATETIME) - 52*7 
*/

UNION ALL

	SELECT 'Y' AS NULLRECORD, 
	IIF(LEFT(OV.DEPRTMNT,1)='3', '60', LEFT(OV.DEPRTMNT,1)+'0') WAREHOUSE, 
	OV.DEPRTMNT AS DEPARTMENT, OV.DEPTDESC, 
	OV.JOBTITLE AS JOBCODE, OV.JOBDESC, 
	0 AS HOURS, 0 AS DOLLARS, NULL AS CHECKDATE, 
	OV.PAYROLCD 
	FROM [GNCGPDB\GP2018].PROD.DBO.v_GNC_ProjectReportByDeptWithContractLabor OV (NOLOCK) 
/* DOES THE SAME BELOW AS ABOVE:
	SELECT 'Y' AS NULLRECORD, 
	IIF(LEFT(GLF.DEPRTMNT,1)='3', '60', LEFT(GLF.DEPRTMNT,1)+'0') WAREHOUSE, 
	GLF.DEPRTMNT AS DEPARTMENT, UPR40300.DSCRIPTN DEPTDESC, 
	GLF.JOBTITLE AS JOBCODE, UPR40301.DSCRIPTN JOBDESC, 
	0 AS HOURS, 0 AS DOLLARS, NULL AS CHECKDATE, 
	GLF.PAYROLCD 
	FROM [GNCGPDB\GP2018].PROD.DBO.UPR30300 GLF (NOLOCK) 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40301 UPR40301 (NOLOCK) ON GLF.JOBTITLE=UPR40301.JOBTITLE 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40300 UPR40300 (NOLOCK) ON GLF.DEPRTMNT=UPR40300.DEPRTMNT
	WHERE  GLF.PYRLRTYP=1 
	AND GLF.JOBTITLE NOT IN 
			(
				'12702', '12703', 
				'60201', '60201C', '60202', '60300', '60300F', 
				'80100', '80500', '81000', '83001', '83002', '83500', 
				'90101', '90101P', '90101T', '90102', '90203', '90203F', '90203P'
			) 
	AND GLF.PAYROLCD NOT IN ('LIFE','VEHICL')
	AND GLF.CHEKDATE > CAST ('09/01/2019' AS DATETIME) - 52*7 

UNION ALL

	SELECT 'Y' AS NULLRECORD, 
	IIF(LEFT(CON.DPRTMNT,1)='3', '60', LEFT(CON.DPRTMNT,1)+'0') WAREHOUSE, 
	CON.DPRTMNT AS DEPARTMENT, UPR40300.DSCRIPTN DEPTDESC, 
	CON.JOBTITLE AS JOBCODE, UPR40301.DSCRIPTN JOBDESC, 
	0 AS HOURS, 0 AS DOLLARS, NULL AS CHECKDATE, 
	CON.PAYROLCD 
	FROM [GNCGPDB\GP2018].PROD.DBO.ContractLaborPay CON (NOLOCK) 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40301 UPR40301 (NOLOCK) ON CON.JOBTITLE=UPR40301.JOBTITLE 
	JOIN [GNCGPDB\GP2018].PROD.DBO.UPR40300 UPR40300 (NOLOCK) ON CON.DPRTMNT=UPR40300.DEPRTMNT
	WHERE  CON.PYRLRTYP=1 
	AND CON.JOBTITLE NOT IN 
			(
				'12702', '12703', 
				'60201', '60201C', '60202', '60300', '60300F', 
				'80100', '80500', '81000', '83001', '83002', '83500', 
				'90101', '90101P', '90101T', '90102', '90203', '90203F', '90203P'
			) 
	AND CON.PAYROLCD NOT IN ('LIFE','VEHICL')
	AND CON.CHEKDATE > CAST ('09/01/2019' AS DATETIME) - 52*7 
*/

) X

GROUP BY NULLRECORD, 
	WAREHOUSE, 
	DEPARTMENT, 
	DEPTDESC, 
	JOBCODE, 
	JOBDESC, 
	CHECKDATE, 
	PAYROLCD 
